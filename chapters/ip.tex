\Chapter{Internet Protocol}
\label{chap:ip}

\Section{IP addresses}
\label{sec:ip-address}
   
\Paragraph{32 bits}
\mode<article>{
To a computer an IP address is just a 32-bit number.
For example, the number \num{117540347} converts to binary as

\begin{center}
\lstinline{0000 1010 1001 0101 0000 1100 1111 1011}
\end{center}     
}
\slide[\num{117540347}]{0000 1010 1001 0101 0000 1100 1111 1011}

\Paragraph{four octets}
\mode<article>{
To make this 32-bit number more manageable to humans, we group the 32 bits into four sets of eight bits, called \emph{octets}.%
\footnote{Currently all bytes are also eight bits so the words octet and byte are interchangeable.
    However, the size of the byte has historically been hardware-dependent and no definitive standards existed that mandated the size.
    Sizes from 1~to~48 bits have been used.
    For example, the PDP-7, a predecessor of the PDP-11, was an 18-bit machine.
    }
}

\Paragraph{dotted decimal}
\mode<article>{
We then convert these octets into decimal and separate the four octets with a dot.
This turns the number \num{117540347} into the more human-friendly format 10.149.12.251.
Because each decimal number is in fact an octet (eight bits), the biggest number is \texttt{1111 1111} or 255 in decimal.

We can state this a bit more mathematically.
Each bit has two possible values, 0 or 1.
Eight bits then give us $2^8 = 256$ possible combinations or the values from 0 to 255.
The format of an IP address thus is $x_1.x_2.x_3.x_4$ with $x_i \in [0,255]$.
}
\slide{$2^8=256 \quad \Rightarrow x_i \in [0,255]$}

\Paragraph{hierarchy}
\mode<article>{
Similar to a street address, IP addresses also have an hierarchy.
While a street address is structured as country, city, street, and house number, an IP address is structured using \emph{supernetting}, \emph{subnetting}, and the division between the network and the host part.
}

\Paragraph{network part}
\mode<article>{
Each IP address consists of two parts.
The first, left, part uniquely identifies the local network to which the address belongs.
This is the network part or \emph{network number}.
All computers attached to the same local network need an IP address with the same network number.
}

\Paragraph{host part}
\mode<article>{
The \emph{host identifier} is the second part, on the right of the network number, which uniquely identifies the node on the network.
}

\Paragraph{subnet mask}
\mode<article>{
The subnet mask is also a 32-bit number consisting of two parts.
Starting from the left, there is a set of one's for the network part of the IP address.
This is followed by a set of zero's for the host part.
For example, the subnet mask 255.255.255.0 consists of 24 one's followed by 8 zero's.
This means that the first 24 bits -- or first three octets -- indicate the network, while the last 8 bits are used to uniquely identify hosts within the network.
This means there can be up to $2^8=256$ hosts in the network.
}

\mode<article>{
A second example could be 255.255.255.192.
Converting these octets to binary gives us 26 consecutive one's followed by 6 zero's.
This means that the first 26~bits of the accompanying IP address are the network number and the last six bits are the host identifier.
}

\Paragraph{network address}
\mode<article>{
Each local network requires two special addresses that can not be assigned to hosts.
The first is the network address.
It is the first IP address in the network, i.e.~the IP address where the host part consists of only zero's.
}

\Paragraph{broadcast address}
\mode<article>{
The second special IP address is the broadcast address.
It is the last IP address in the network, i.e.~the IP address where the host part consists of only one's.%
\footnote{Even though I was always told the first address is the network address and the last address is the broadcast address, in fact both the first and the last address once were used as the broadcast address for the network by \href{https://github.com/schoen/unicast-extensions/blob/master/LOWEST.md}{4.2BSD}, an operating system from 1983.}
}

\Paragraph{local broadcast address}
\mode<article>{
Every (sub)network has its own broadcast address as the last IP address in the range.
There is a second broadcast address, 255.255.255.255, which is a link-local broadcast address.
It can only be used to communicate on the local link as routers do not forward packets with this destination address onto other networks.
}

\Paragraph{default gateway}
\mode<article>{
The default gateway is not a special address.
It is just the IP address of the router that connects your local network to the other networks.
Most of the time it is either the first \emph{available} IP address in the network or the last.
But this is not a requirement and it can be any available address in the network.
}

\Paragraph{loopback address}
\mode<article>{
All IP addresses starting with 127 are reserved for the loopback address.
There are people in the industry who want to free up a large chunk of these addresses for public use and only keep the 127.0.0.0/16 range for loopback addresses.%
\footnote{See \href{https://github.com/schoen/unicast-extensions}{The IPv4 cleanup project} on GitHub.}
All other IP addresses will become publicly available.
However, this might take a few more years to become a reality.
}

\Section{A bit of history}
\label{sec:ip-history}

\Paragraph[1980]{N.H.H.H}
\mode<article>{
At first there were only 256 networks (the first octet) and each network could contain over 16 million hosts.
With both the 0 and 255 networks reserved, in reality only 254 network could be used.
}

\Paragraph[1981]{classful addressing}
\mode<article>{
As the Internet community realised 254 networks were not enough, they kept the networks that were already assigned to companies and created a new system based on classes.
The first octet of the IP address determined that class of IP address and the class determined the size of the network, i.e.~which part is used for the network and which part is used for the host address.
\Vref{tab:classful-addressing} shows the different classes, their subnet mask and the number of hosts per network.
An IP address belongs to a certain class if the first octet falls into the given range.
For example, the IP address 198.51.100.37 falls into the class~C range as $192\le198\le223$ so the first three octets determine the network and the fourth octet identifies the host within the given network.
}
\newsavebox{\classful}
\savebox{\classful}{
   \sffamily
   \begin{tabular}{crllr}
   \textbf{class} & \textbf{range} & \textbf{format} & \textbf{subnet mask} & \textbf{\# addresses} \\[1ex]
   A & 0--127 & N.H.H.H & 255.0.0.0 & \num{16777216} \\
   B & 128--191 & N.N.H.H & 255.255.0.0 & \num{65536} \\
   C & 192--223 & N.N.N.H & 255.255.255.0 & \num{256} \\
   D & 224--239 & \textit{multicast} & -- & -- \\
   E & 240--255 & \textit{reserved} & -- & -- \\
   \end{tabular}
}
\mode<article>{
\begin{table}
   \caption{Classful addressing (1981)}
   \label{tab:classful-addressing}
   \centering
   \sffamily
   \usebox\classful
\end{table}
}
\mode<beamer>{
\begin{frame}
\begin{center}
\usebox\classful
\end{center}
\end{frame}
}
\mode<article>{
This can be gathered from the third (format) and fourth (subnet mask) columns.
The third column indicates that the first three octets indicate the network number (N) while the fourth octet is the host identifier (H).
The fourth column translates this into something the computer can use with an AND operation.
The subnet mask contains binary one's when the corresponding bits of the IP address are used to indicate the network number.
The subnet mask contains binary zero's when those corresponding bits are used for the host identifier.

Note that the subnet mask did not exist when these classes were introduced.
The subnet mask only came to be with the concept of \emph{subnetting} but the mask is included in \cref{tab:classful-addressing} for completeness and reference.
}

\Paragraph[1985]{subnetting}
\mode<article>{
A subnetwork or subnet is a logical subdivision of an IP network.
The practice of dividing a network into two or more networks is called subnetting.
Computers that belong to the same subnet are addressed with an identical most-significant bit-group in their IP addresses.
This results in the logical division of an IP address into two fields: the \emph{network number} or \emph{routing prefix} and the \emph{rest field} or \emph{host identifier}. The rest field is an identifier for a specific host or network interface.
}

\Paragraph[1992]{supernetting}
\mode<article>{
A supernetwork, or supernet, is an IP network that is formed by combination of multiple networks (or subnets) into a larger network.
The new routing prefix for the combined network represents the constituent networks in a single routing table entry.
The process of forming a supernet is called supernetting, \emph{prefix aggregation}, \emph{route aggregation}, or \emph{route summarisation}.

This basically means that the classes from \vref{tab:classful-addressing} no longer exist.
Every network needs a subnet mask that can have anywhere from one to thirty two bits allocated to the network number.
See \vref{sec:subnetting} for the details.

Let's take a look at two examples.
In the first example, we group the networks 198.18.0.0/16 and 198.19.0.0/16 into the supernet 198.18.0.0/15.
The third row displays the subnet mask in binary format.

\begin{center}
\sffamily
\begin{tabular}{c|c@{\qquad}l}
\color{spot1} 1100 0110 . 0001 001\color{spot2} 0 & . 0000 0000 . 0000 0000 & 198.18.0.0/16 \\
\color{spot1} 1100 0110 . 0001 001\color{spot2} 1 & . 0000 0000 . 0000 0000 & 198.19.0.0/16 \\
\hline
1111 1111 . 1111 1111 & . 0000 0000 . 0000 0000 & 255.255.0.0 \\
1111 1111 . 1111 1110 & . 0000 0000 . 0000 0000 & 255.254.0.0 \\
\end{tabular}
\end{center}


We can clearly see that the two networks are unique as the sixteenth bit from the left (in \textcolor{spot2}{magenta}) is different for both networks.
We can also see that the first fifteen bits (in \textcolor{spot1}{some kind of green}) are identical for both networks.


With \emph{supernetting} you can group both networks using one network address.
Write down the identical bits in decimal.
This gives us 198.18.0.0.
Now create a custom subnet mask indicating how many bits are shared between both networks.
As there are fifteen bits shared, this gives us 255.\textbf{254}.0.0.

For the second example, take 198.19.0.0/16 and 198.20.0.0/16, displayed in bold in the table below.
When we want to combine both networks in a supernet, we must take together the identical bits on the left and turn all the hosts bits to zero (to make the network address).
There are only thirteen bits identical. The last three bits differ.
Thus this supernet would be 198.16.0.0 with a subnet mask of 255.248.0.0.
However, this supernet includes all the other networks as well, from 198.16.0.0 to 198.23.0.0 as all these networks share the same thirteen leftmost bits.


\begin{center}
\sffamily
\begin{tabular}{c|cl}
\color{spot1} 1100 0110 . 0001 0\color{spot2} 000 & . 0000 0000 . 0000 0000 & 198.16.0.0/16 \\
\color{spot1} 1100 0110 . 0001 0\color{spot2} 001 & . 0000 0000 . 0000 0000 & 198.17.0.0/16 \\
\color{spot1} 1100 0110 . 0001 0\color{spot2} 010 & . 0000 0000 . 0000 0000 & 198.18.0.0/16 \\
\bfseries\color{spot1} 1100 0110 . 0001 0\bfseries\color{spot2} 011 & \bfseries . 0000 0000 . 0000 0000 & \bfseries198.19.0.0/16 \\
\bfseries\color{spot1} 1100 0110 . 0001 0\bfseries\color{spot2} 100 & \bfseries . 0000 0000 . 0000 0000 & \bfseries 198.20.0.0/16 \\
\color{spot1} 1100 0110 . 0001 0\color{spot2} 101 & . 0000 0000 . 0000 0000 & 198.21.0.0/16 \\
\color{spot1} 1100 0110 . 0001 0\color{spot2} 110 & . 0000 0000 . 0000 0000 & 198.22.0.0/16 \\
\color{spot1} 1100 0110 . 0001 0\color{spot2} 111 & . 0000 0000 . 0000 0000 & 198.23.0.0/16 \\
\hline
1111 1111 . 1111 1111 & . 0000 0000 . 0000 0000 & 255.255.0.0 \\
1111 1111 . 1111 1000 & . 0000 0000 . 0000 0000 & 255.248.0.0 \\
\end{tabular}
\end{center}
}

\Paragraph[1993]{classless inter-domain routing}
\mode<article>{
Classless inter-domain routing (CIDR) is a method for allocating IP addresses and for IP routing.
The Internet Engineering Task Force (IETF) introduced CIDR to replace the previous classful network addressing architecture on the Internet.
Its goal was to slow the growth of routing tables on routers across the Internet, and to help slow the rapid exhaustion of IPv4 addresses.
}

\Paragraph[1998]{IP version 6}
\mode<article>{
IPv6 was developed by the Internet Engineering Task Force (IETF) to deal with the long-anticipated problem of IPv4 address exhaustion, and is intended to replace IPv4.
In December 1998, IPv6 became a draft standard for the IETF, which subsequently ratified it as an internet standard on 14 July 2017.
}


\Section{Subnetting}
\label{sec:subnetting}

\newsavebox{\subnettingOne}
\savebox{\subnettingOne}{
\begin{tikzpicture}
   \draw[white] (0,-35mm) -- (0,35mm);
   \draw[white] (-56mm,0) -- (56mm,0);
   \pie[sum = auto,
         color = {
            spot1,
            spot1!66,
            spot2,
            spot3!20
         }
      ]{64/{\small 198.51.100.0/26},
         64/{\small 198.51.100.64/26},
         64/{\small 198.51.100.128/26},
         64/{\small 198.51.100.192/26}}
\end{tikzpicture}
}

\mode<article>{
\begin{figure}
   \centering
   \usebox\subnettingOne
   \caption{With subnetting you can divide a block of 256~IP addresses into four smaller blocks of 64~addresses each}
   \label{fig:subnetting}
\end{figure}
}

\mode<beamer>{
\begin{frame}
\begin{center}
\scalebox{.9}{\usebox\subnettingOne}
\end{center}
\end{frame}
}

\newsavebox{\subnettingTwo}
\savebox{\subnettingTwo}{
\begin{tikzpicture}
   \draw[white] (0,-35mm) -- (0,35mm);
   \draw[white] (-56mm,0) -- (56mm,0);
   \pie[sum = auto,
         color = {
            spot1,
            spot1!66,
            spot2,
            spot3!40,
            spot3!20
         }
      ]{64/{\small 198.51.100.0/26},
         64/{\small 198.51.100.64/26},
         32/{\small 198.51.100.128/27},
         32/{\small 198.51.100.160/27},
         64/{\small 198.51.100.192/26}}
\end{tikzpicture}
}

\mode<article>{
\begin{figure}
   \centering
   \usebox\subnettingTwo
   \caption{When using variable-length subnet masks you can further divide a subnet into smaller segments}
   \label{fig:vlsm}
\end{figure}
}
\mode<beamer>{
\begin{frame}
\begin{center}
\scalebox{.9}{\usebox\subnettingTwo}
\end{center}
\end{frame}
}


\Paragraph{prefix}
\mode<article>{
The network prefix is the first part of the IP address, identifying the network.
}

\Paragraph{prefix length}
\mode<article>{
The prefix length is the size of the prefix in number of bits.
It translates directly to the subnet mask.
The prefix length is the number of ones in the subnet mask.
}


\Paragraph{Why do we need subnetting?}
\mode<article>{
We are the network administrators of a small company.
We have a couple (50) of desktop computers for the employees, as well as a few (10) servers.
We contact RIPE NCC%
    \footnote{Réseaux IP Européens Network Coordination Centre (RIPE NCC) is the \emph{regional Internet registry} (RIR) for Europe, the Middle East and parts of central Asia. As a RIR, it oversees the allocation and registration of Internet number resources such as IP addresses and autonomous system numbers.}
and tell them we need sixty IP addresses, plus some extra just in case we will grow and need more computers.
Since a class~c address range contains 256~IP addresses, RIPE will give us one such range, e.g.~198.51.100.0/24.

Now we have a problem.
We have plenty of IP addresses but we need two separate networks.
Or perhaps we need three or even four.
Maybe we want to isolate the public Internet-facing servers from the private servers that should not be reachable from the Internet.

Remember that these different classes are just made-up methods of determining which part of the IP address is the network number and which part is the host identifier.
IP addresses themselves are just 32-bit numbers so we can group them any way we like.
}


\Section{Dynamic Host Configuration Protocol}
\label{sec:dhcp}


\Paragraph{simplifies IP address configuration}
\mode<article>{
Without DHCP you would have to contact a network administrator every morning at work when you power on your laptop and want to connect it to the (wireless) network.
Back at home or at a friend's place you need to change the IP settings again, including which DNS servers to use.
This requires huge lists with available IP addresses which are being updated constantly with newly available IP addresses -- should you remember to contact your network administrator before leaving work -- or available IP addresses becoming unavailable as people come in to work every morning.
}

\Paragraph{DORA}
\mode<article>{
DHCP operations fall into four phases: server discovery, IP address lease offer, lease request, and lease acknowledgement.
These stages (see \vref{fig:dora}) are often abbreviated as ``DORA'' for discovery, offer, request, and acknowledgement.

\begin{figure}
    \centering
    \input{images/dora.tex}
    \caption{The foure stages of acquiring an IP address from a DHCP server}
    \label{fig:dora}
\end{figure}
}
\mode<beamer>{
\begin{frame}
\begin{center}
\input{images/dora}
\end{center}
\end{frame}
}


\Paragraph{lease time}
\mode<article>{
When the server offers the client an IP address, it does this for a specific lease time.
After this time expires, the client must relinquish the given IP address.
To prevent the client from getting disconnected from the network while it requests a new IP address, it can refresh the lease on its current IP address midway the lease period.

For example, when the client gets an IP address with a lease time of eight hours, it can refresh the lease period after four hours.
If the server grants this request, the lease is again valid for eight hours.

If the DHCP server denies the request, the client loses the lease right away.
It cannot use the IP address for the remaining four hours but must send a DHCP discover message to request a new IP address.
}

\Paragraph{DHCP relay}
\mode<article>{
As it is impractical to configure a DHCP server on each network, routers can be configured to act as DHCP relays, forwarding the broadcast messages as unicast to a remote DHCP server.
}

\Section{Network address translation}
\label{sec:nat}


\Paragraph{private IP space}
\mode<article>{
There is nothing special about ``private'' IP addresses.
They are not treated any different from ``public'' IP addresses by routers or end hosts.
The only difference is that they \emph{should} not be routed on the public Internet.
This means that Internet service providers (ISP) should block packets with a private IP address as either the source or the destination address.

There are several blocks of private IP addresses which can be used internally by organisations without having to ask for permission to do so.
These include:
\begin{multicols}{3}
\raggedcolumns
\begin{itemize}
\item 10.0.0.0/8
\item 169.254.0.0/16
\item 172.16.0.0/12
\item 192.168.0.0/16
\item 100.64.0.0/10
\item 192.0.2.0/24
\item 198.18.0.0/15
\item 198.51.100.0/24
\item 203.0.113.0/24
\end{itemize}
\end{multicols}

The address range 169.254.0.0/16 is a special case.
These are defined as ``link-local'' addresses which cannot be forwarded by a router.
Microsoft uses these addresses as APIPA or \emph{automatic private IP addressing}.
A Windows computers takes a random IP address from this range when it is configured to receive an IP address from a DHCP server but it receives no responses from any DHCP server.
}

\Paragraph{port-based address translation}
\mode<article>{
The majority of network address translators map multiple private hosts to one publicly exposed IP address.
In a typical configuration, a local network uses one of the designated private IP address subnets (RFC~1918).
A router in that network has a private address of that address space.
The router is also connected to the Internet with a public address, typically assigned by an Internet service provider.

As traffic passes from the local network to the Internet, the source address in each packet is translated on the fly from a private address to the public address.
The router tracks basic data about each active connection (particularly the destination address and port).
When a reply returns to the router, it uses the connection tracking data it stored during the outbound phase to determine the private address on the internal network to which to forward the reply.

All IP packets have a source IP address and a destination IP address.
Typically packets passing from the private network to the public network will have their source address modified, while packets passing from the public network back to the private network will have their destination address modified.
To avoid ambiguity in how replies are translated, further modifications to the packets are required.
For TCP and UDP the port numbers are changed so that the combination of IP address and port number on the returned packet can be unambiguously mapped to the corresponding private network destination.
RFC~2663 uses the term \emph{network address and port translation} (NAPT) for this type of NAT.
Other names include \emph{port-based address translation} (PAT), IP \emph{masquerading}, NAT \emph{overload} and \emph{many-to-one} NAT.
This is the most common type of NAT and has become synonymous with the term ``NAT'' in common usage.
}

\Paragraph{pool of public addresses}
\mode<article>{
It is possible to use multiple public IP addresses to translate the private IP address into.
When this is used in combination with port-based address translation, it allows for multiple thousands of private hosts to communicate on the Internet.
}

\Paragraph{one-to-one translation}
\mode<article>{
This method is most often used to translate a range of private IP addresses into a different range of private IP addresses.
This is often needed when two companies with overlapping IP address space connect their networks together.
}

\Section{Routing}
\label{sec:routing}

\Paragraph{What is a router?}
\mode<article>{
A router is really just a specialised computer that \emph{forwards} packets it receives but which are not destined for itself.
A computer can also be configured to function as a router by turning on this option (\vref{lst:freebsd-enable-routing,lst:rhel-enable-routing}).
}

\newsavebox{\lstrouterOne}
\newsavebox{\lstrouterTwo}
\begin{lrbox}{\lstrouterOne}
\begin{lstlisting}[caption={Enable routing on a FreeBSD host},label={lst:freebsd-enable-routing}]
# sysrc gateway_enable="YES"
# sysctl net.inet.ip.forwarding=1
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\lstrouterTwo}
\begin{lstlisting}[caption={Enable routing on a RHEL host},label={lst:rhel-enable-routing}]
# echo "net.ipv44.ip_forward=1" >> /etc/sysctl.conf
# echo 1 > /proc/sys/net/ipv4/ip_forward
\end{lstlisting}
\end{lrbox}
\mode<article>{
\noindent
\usebox\lstrouterOne

\noindent
\usebox\lstrouterTwo

When a router receives a packet with a destination IP address which does not belong to any of the router's interfaces, the router looks up the IP address in its \emph{routing table} and forwards the packet out the given interface.
}
\newsavebox{\lstrouterThree}
\begin{lrbox}{\lstrouterThree}
\begin{lstlisting}[caption={The routing table on a linux machine},label={fig:routing-table}]
[doyle] ~ $ netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Iface
10.0.0.0        172.24.12.1     255.255.240.0   eth1
10.0.16.0       172.24.12.1     255.255.240.0   eth1
10.0.32.0       192.168.16.1    255.255.224.0   eth2
172.21.3.0      0.0.0.0         255.255.255.0   eth0
172.24.12.0     0.0.0.0         255.255.255.0   eth1
192.168.16.0    0.0.0.0         255.255.255.0   eth2
0.0.0.0         172.21.3.1      0.0.0.0         eth0
\end{lstlisting}
\end{lrbox}
\mode<article>{
\noindent
\usebox\lstrouterThree

Routers only know about the networks they directly connect to.
They must thus learn about distant networks.
This can happen in one of two ways, either the network administrator manually configures the router to forward a certain prefix to some other router (the \emph{next-hop} router) or the routers in a network can use a \emph{dynamic routing protocol} to teach each other about the networks they know and how to reach them.
}

\Paragraph{time to live}
\mode<article>{
The IP header contains a time-to-live (TTL) field which indicates how many routers (hops) it can pass before it must be deleted.
This prevents the data packet from circulating indefinitely.
As it is an 8-bit field, the maximum value is 255 but a recommended initial value is~64.\footnote{See RFC~1700, p.~64.}
}


\Paragraph{fragmentation}
\mode<article>{
Different physical media have different maximum frame sizes.
For example, Ethernet has a maximum frame size of 1518~bytes or a \emph{maximum transmission unit} (MTU) of 1500~bytes, which is the frame size minus the header length.
Token Ring has a much larger MTU of 4464~bytes, ATM and X.25 have much smaller MTUs of 48~and 576~bytes respectively.

When a router connects an Ethernet segment to an ATM circuit, it must \emph{fragment} the 1500-byte frames it receives into 48-byte cells that it can forward across the ATM network.
Once fragmented, routers do not reassemble the pieces back together as they might take different paths through the network and are not guaranteed to arrive in the correct order.
The end host is responsible for piecing all fragments back together.
}

\Paragraph{broadcast domain}
\mode<article>{
A \emph{broadcast domain} is that part of the network to which a broadcast messages propagates.
One of the functions of a router is to stop broadcasts, not forwarding the to other parts of the network.
}

\Paragraph{static routing}
\mode<article>{
Static routing is a form of routing that occurs when a router uses a manually-configured routing entry, rather than information from dynamic routing traffic.
In many cases, static routes are manually configured by a network administrator by adding in entries into a routing table, though this may not always be the case.
Unlike dynamic routing, static routes are fixed and do not change if the network is changed or reconfigured.
Static routing and dynamic routing are not mutually exclusive.
Both dynamic routing and static routing are usually used on a router to maximise routing efficiency and to provide backups in case dynamic routing information fails to be exchanged.
Static routing can also be used in \emph{stub networks},%
\footnote{%
A stub network is a (part of a) network with only one way to reach the rest of the network.
It thus does not need detailed knowledge about the network but can usually route all traffic using a single default route pointing to the exit point.
}
or to provide a gateway of last resort.
}


\Paragraph{dynamic routing protocols}
\mode<article>{
\begin{description}
\item[distance-vector]
A distance-vector routing protocol is like putting signposts on every crossroads with the router being the crossroads.
Every router learns about all networks but only the direction it has to send traffic to (the next-hop router) and the total distance to reach the remote network.
\item[link-state]
A link-state routing protocol is comparable to every router building a roadmap with all links interconnecting the different routers included.
Once the entire map has been drawn, each router can calculate the best path to reach each destination.
\end{description}
}
\slide{distance-vector}
\slide{link-sate}

\Paragraph{metric}
\mode<article>{
When we take a look at \vref{fig:metric}, we see that router $R_4$ connects to the network 192.0.2.0/24.
It advertises this to routers $R_2$ and $R_3$ which in turn both advertise this network to router $R_1$.
Router $R_1$ now knows two paths to reach the destination network 192.0.2.0/24, once via $R_2$ and once via $R_3$.
For $R_1$ to decide which path is best, it compares the \emph{metric} of both paths; the lowest value is the best path.

When a router advertises a network, it includes a metric value.
When another router forwards this information -- e.g.~router $R_2$ forwards the information about network 192.0.2.0/24 to router $R_1$ -- it updates the metric value.

Every routing protocol can use a different metric.
RIP uses a simple \emph{hop count} or the number of routers you have to traverse to reach your destination.
OSPF and IS-IS use a generic \emph{cost} value.
Most OSPF implementation use a cost value based on the bandwidth of the links while with IS-IS the network administrator has to manually set a cot value for each link.
EIGRP uses a very complex formula to determine the metric, see \vref{eqn:eigrp-metric}.

\begin{figure}
   \centering
   \input{images/metric}
   \caption{A router can learn a prefix from several other routers. The metric decides the best route.}
   \label{fig:metric}
\end{figure}
}

\Paragraph{Routing Information Protocol (RIP)}
\mode<article>{
The Routing Information Protocol is an example of a distance-vector routing protocol using the \emph{hop count} or the number of routers to count how good a given path is.
It is a very simple protocol useful in smaller networks.
The protocol is not suitable for larger networks because of its slow \emph{convergence time} and its tendency to propagate good information slowly and negative information quickly.

\begin{description}
\item[route poisoning]
The main issue with distance-vector routing protocols is routing loops. This routing loop in the network causes the count-to-infinity problem.
Routing loops usually occur when an interface goes down or two routers send updates at the same time.
% TODO: finish the paragraph
% source: https://www.geeksforgeeks.org/route-poisoning-and-count-to-infinity-problem-in-routing/

\item[split horizon]
% TODO: explain this
\item[hold-down timer]
% TODO: explain this
\end{description}
}


\Paragraph{Enhanced Interior Gateway Routing Protocol (EIGRP)}
\mode<article>{
This protocol was a Cisco proprietary protocol which has been made publicly available in 2013 but has not been implemented by other vendors.

While RIP and OSPF have a very simple metric, EIGRP has a rather complex one.
The metric $m$ is calculated as such:
\begin{equation}
m = \left[\left(k_1 B_m  + k_2 \frac{B_m}{256-L} + k_3 D_s\right) \times \frac{k_5}{k_4} \frac{1}{R}\right] \times 256,
\label{eqn:eigrp-metric}
\end{equation}
with $B_m$ being the minimum bandwidth along the path to the destination, $D_s$ being the total delay along the path, $L$ and $R$ being the load an the reliability of the link respectively, taken over a five-minute interval.
The five $k$-values are user-configurable weights to each part of the equation.
% TODO: finish this paragraph

As if \cref{eqn:eigrp-metric} is not complex enough, there are a few important caveats.
% TODO: finish this paragraph
}

\Paragraph{Open Shortest Path First (OSPF)}
\mode<article>{
The Open Shortest Path First protocol is a link-state routing protocol suitable for small network all the way up to massive service provider networks.
% TODO: expand on this paragraph
}

\Paragraph{Border Gateway Protocol (BGP)}
BGP is neither a distance-vector nor a link-state routing protocol.
It is the only \emph{path-vector} routing protocol and it is used to interconnect different \emph{autonomous systems}, meaning it can be used to interconnect networks operated by different organisations.
A basic BGP configuration is relatively simple but it can quickly become extremely complex.

Contrary to normal routing protocols which serve to make all networks known within the entire internetwork, BGP aims to limit reachability and focusses on \emph{policies}.
You can tweak the protocol so that you can exactly control the path a packet has to travel through the network to reach its destination.
